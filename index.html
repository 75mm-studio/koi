<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/pikaday.css" rel="stylesheet">
    <link href="css/handsontable.full.min.css" rel="stylesheet" media="screen">

    <style>
      .currentRow {
        background-color: #E7E8EF !important;
      }

      .currentCol {
        background-color: #E7E8EF !important;
      }

    </style>

    <title>KOI2</title>
  </head>
  <body>
    <nav class="navbar navbar-light bg-light">
      <span class="navbar-brand mb-0 h1">KOI</span>
      <form class="form-inline my-2 my-lg-0">
        <button class="btn btn-outline-primary mr-sm-2" type="button" onclick="location.href='index.html' ">Shot DB</button>
        <button class="btn btn-outline-success mr-sm-2" type="button" onclick="location.href='gantt.html'">Gantt Chart</button>
        <button class="btn btn-outline-danger my-2 my-sm-0" type="button" onclick="location.href='camdb.html'">Camera DB</button>
      </form>
    </nav>

    <div id="shotdb"></div>

    <script src="js/handsontable.full.min.js"></script>
    <script src="js/moment.js"></script>
    <script src="js/pikaday.js"></script>

    <script type="text/javascript" src="data/test.js"></script>

    <script>
      var container;
      var hot;

      function statusRenderer(instance, td, row, col, prop, value, cellProperties) {
        Handsontable.renderers.TextRenderer.apply(this, arguments);

        if (value === 'Ready') {
          td.style.background = '#d93749';
        }

        if (value === 'Wip') {
          td.style.background = '#fdc02f';
        }

        if (value === 'Done') {
          td.style.background = '#30a54a';
        }

        if (value === 'Omit') {
          td.style.background = '#6b747c';
        }
      }

      function imageRenderer(instance, td, row, col, prop, value, cellProperties) {
        Handsontable.renderers.cellDecorator.apply(this, arguments);
        Handsontable.dom.fastInnerHTML(td, '<img class="img" style="max-width: 100%; height: auto; display: block;" src=' + value + '>');
      }

      Handsontable.renderers.registerRenderer('statusRenderer', statusRenderer);

      container = document.getElementById('shotdb');
      hot = new Handsontable(container, {
        //readOnly: false,
        //editor: false,
        //data: Handsontable.helper.createSpreadsheetData(60, 13),
        data: JSON.parse(JSON.stringify(db)),
        rowHeaders: false,
        colHeaders: ['Show', 'Shot', 'Thumbnail', 'In', 'Out', 'Start', 'Due', 'Assign', 'Status', 'Preview', 'Camera', 'Lens', 'Task'],
        columns: [
          {data: "Show", readOnly: true},
          {data: "Shot", readOnly: true},
          {data: "Thumbnail", width: "200px", renderer: imageRenderer},
          {data: "In", readOnly: true},
          {data: "Out", readOnly: true},
          {data: "Start", type: 'date', dateFormat: 'YYYY/MM/DD'},
          {data: "Due", type: 'date', dateFormat: 'YYYY/MM/DD'},
          {data: "Assign"},
          {data: "Status", editor: 'select', selectOptions: ['Ready', 'Wip', 'Done', 'Omit']},
          {data: "Preview"},
          {data: "Camera"},
          {data: "Lens"},
          {data: "Task"}
        ],
        filters: true,
        dropdownMenu: ['filter_by_condition', 'filter_action_bar', 'filter_by_value'],
        stretchH: 'all',
        fixedRowsTop: 0,
        fillHandle: false,
        rowHeights: "100%",
        className: "htCenter htMiddle",
        //currentRowClassName: 'currentRow',
        //currentColClassName: 'currentCol',
        multiColumnSorting: true,
        enterBeginsEditing: false,
        cells: function (row, col) {
          var cellProperties = {};
          var data = this.instance.getData();

          if (col === 8) {
            cellProperties.renderer = "statusRenderer"; // uses lookup map
          }

          return cellProperties;
        },
        licenseKey: `non-commercial-and-evaluation`
      });


    </script>

  </body>
</html>
